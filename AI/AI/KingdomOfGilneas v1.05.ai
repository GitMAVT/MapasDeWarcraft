//===========================================================================
// 
// Kingdom of Gilneas
// 
//   Warcraft III AI script
//   Generated by the Warcraft III World Editor
// 
//===========================================================================

//***************************************************************************
//*
//*  Global Variables
//*
//***************************************************************************

globals
    integer                 attackWave                 = 1
    integer                 nextDelay                  = 0
    integer                 awGold                     = 0
    integer                 awWood                     = 0
    //integer                 Comport6                   = GetRandomInt(1,100)
    // Conditions
    boolean                 gCond_BuildGeneral         = false
    boolean                 gCond_BuildTowers          = false
    boolean                 gCond_HeroFirst            = false
    boolean                 gCond_HeroSecond           = false
    boolean                 gCond_HeroThird            = false
    boolean                 gCond_TrainAxemen          = false
    boolean                 gCond_TrainWildWorges      = false
    boolean                 gCond_TrainRiflemen        = false
    boolean                 gCond_TrainKnights         = false
    boolean                 gCond_TrainProtectos       = false
    boolean                 gCond_TrainRiflemanWorges  = false
    boolean                 gCond_TrainProtectorWorges = false
    boolean                 gCond_TrainKnightWorges    = false
    boolean                 gCond_BuildTownHall        = false
    boolean                 gCond_UpgradeToKeep        = false
    boolean                 gCond_UpgradeToCastle      = false
    boolean                 gCond_Workers1             = false
    boolean                 gCond_Workers2             = false
    boolean                 gCond_Workers3             = false
    boolean                 gCond_NeedExp              = false
    boolean                 gCond_NeedExp2             = false
    boolean                 gCond_AttackWithAxemen     = false
    boolean                 gCond_AttackWithRiflemen   = false
    boolean                 gCond_AttackWithKnights    = false
    boolean                 gCond_AttackWithRavensAnim = false
    boolean                 gCond_AttackWithBearsAnim  = false
    boolean                 gCond_AttackWithProtectors = false
    boolean                 gCond_AttackWithDragonitos = false
    boolean                 gCond_AttackWithRocTwoHeads = false
    boolean                 gCond_AttackWithCannons    = false
    boolean                 gCond_AttackWithWildWorgens = false
    boolean                 gCond_AttackWithRiflemanWorgens = false
    boolean                 gCond_AttackWithKnightWorgens = false
    boolean                 gCond_AttackWithProtectorWorgens = false
    boolean                 gCond_BuildHumanBarracks   = false
    boolean                 gCond_BuildWorgenBarracks  = false
    boolean                 gCond_TrainProtectosAI     = false
    boolean                 gCond_AtacarAEnemigo       = false
    boolean                 gCond_Farmeo_avanzado      = false
    boolean                 gCond_Farmeo_Mediano       = false
    boolean                 gCond_NeedExpansionRequiere = false
    boolean                 gCond_RushCommand          = false
    boolean                 gCond_RushForces           = false
endglobals

//***************************************************************************
//*
//*  Utility Functions
//*
//***************************************************************************

//===========================================================================
function CheckLastCommand takes boolean pop returns integer
    local integer cmd = GetLastCommand()
    if (pop) then
        call PopLastCommand(  )
    endif
    return cmd
endfunction

//===========================================================================
function CheckLastCommandData takes boolean pop returns integer
    local integer data = GetLastData()
    if (pop) then
        call PopLastCommand(  )
    endif
    return data
endfunction

//===========================================================================
function TotalFoodProduced takes nothing returns integer
    return GetPlayerState(ai_player,PLAYER_STATE_RESOURCE_FOOD_CAP)
endfunction

//===========================================================================
function ExpansionNeeded takes nothing returns boolean
    return take_exp
endfunction

//===========================================================================
function BuildExpansion takes integer hallID, integer mineID returns nothing
    if (HallsCompleted(hallID)) then
        call SetBuildExpa( TownCount(hallID) + 1, mineID )
    endif
endfunction

//===========================================================================
function CurrentAttackWave takes nothing returns integer
    return attackWave
endfunction

//===========================================================================
function ResetAttackUnits takes nothing returns nothing
    set awGold = 0
    set awWood = 0
    call InitAssaultGroup(  )
endfunction

//===========================================================================
function AddAttackUnit takes integer minQty, integer maxQty, integer unitID returns nothing
    // Track attacking gold workers
    if (unitID == 'h01H') then
        set awGold = awGold + minQty
    endif

    // Track attacking wood workers
    if (unitID == 'h01H') then
        set awWood = awWood + minQty
    endif

    call SetAssaultGroup( minQty, maxQty, unitID )
endfunction

//***************************************************************************
//*
//*  Basic Options
//*
//***************************************************************************

//===========================================================================
function InitOptions takes nothing returns nothing
    call SetCampaignAI(  )  
    call SetDefendPlayer( false )
    call SetRandomPaths( true )
    call SetTargetHeroes( true )
    call SetPeonsRepair( true )
    call SetHeroesFlee( true )
    call SetHeroesBuyItems( true )
    call SetUnitsFlee( true )
    call SetGroupsFlee( true )
    call SetWatchMegaTargets( true )
    call SetIgnoreInjured( true )
    call SetHeroesTakeItems( true )
    call SetSlowChopping( false )
    call SetCaptainChanges( true )
    call SetSmartArtillery( true )
endfunction

//***************************************************************************
//*
//*  Conditions
//*
//***************************************************************************

//===========================================================================
// Updates the values of all preset conditions
//===========================================================================
function UpdateConditions takes nothing returns nothing
    set gCond_BuildGeneral = ( TownThreatened(  ) == false )
    set gCond_BuildTowers = ( ( TownThreatened(  ) == false ) and ( ( GetUnitCount( 'h02B' ) + ( GetUnitCount( 'h01V' ) + GetUnitCount( 'h01W' ) ) ) < 9 ) )
    set gCond_HeroFirst = ( GetUnitCountDone( 'h01O' ) > 0 )
    set gCond_HeroSecond = ( ( GetUnitCountDone( 'h01O' ) > 0 ) and ( ( GetUnitCountDone( 'h01M' ) > 0 ) or ( GetUnitCountDone( 'h01L' ) > 0 ) ) )
    set gCond_HeroThird = ( ( GetUnitCountDone( 'h01O' ) > 0 ) and ( GetUnitCountDone( 'h01M' ) > 0 ) )
    set gCond_TrainAxemen = ( GetUpgradeLevel( 'R034' ) == 0 )
    set gCond_TrainWildWorges = ( GetUpgradeLevel( 'R034' ) == 1 )
    set gCond_TrainRiflemen = ( GetUpgradeLevel( 'R034' ) == 0 )
    set gCond_TrainKnights = ( GetUpgradeLevel( 'R034' ) == 0 )
    set gCond_TrainProtectos = ( GetUpgradeLevel( 'R034' ) == 0 )
    set gCond_TrainRiflemanWorges = ( GetUpgradeLevel( 'R034' ) == 1 )
    set gCond_TrainProtectorWorges = ( GetUpgradeLevel( 'R034' ) == 1 )
    set gCond_TrainKnightWorges = ( GetUpgradeLevel( 'R034' ) == 1 )
    set gCond_BuildTownHall = ( ( TownThreatened(  ) == false ) and ( ( GetUnitCountDone( 'h01K' ) == 0 ) and ( ( GetUnitCount( 'h01L' ) == 0 ) and ( GetUnitCount( 'h01M' ) == 0 ) ) ) )
    set gCond_UpgradeToKeep = ( ( TownThreatened(  ) == false ) and ( ( GetUnitCountDone( 'h01K' ) > 0 ) and ( ( GetUnitCount( 'h01L' ) == 0 ) and ( GetUnitCount( 'h01M' ) == 0 ) ) ) )
    set gCond_UpgradeToCastle = ( ( TownThreatened(  ) == false ) and ( ( GetUnitCountDone( 'h01L' ) > 0 ) and ( GetUnitCount( 'h01M' ) == 0 ) ) )
    set gCond_Workers1 = ( ( GetUnitCount( 'h01H' ) < 35 ) and ( ( TownHasMine( ( TownWithMine(  ) + 0 ) ) == true ) and ( TownHasHall( ( TownWithMine(  ) + 0 ) ) == true ) ) )
    set gCond_Workers2 = ( ( GetUnitCount( 'h01H' ) < 35 ) and ( ( TownHasMine( ( TownWithMine(  ) + 1 ) ) == true ) and ( TownHasHall( ( TownWithMine(  ) + 1 ) ) == true ) ) )
    set gCond_Workers3 = ( ( GetUnitCount( 'h01H' ) < 35 ) and ( ( TownHasMine( ( TownWithMine(  ) + 2 ) ) == true ) and ( TownHasHall( ( TownWithMine(  ) + 2 ) ) == true ) ) )
    set gCond_NeedExp = ( ( GetGold(  ) < 1000 ) and ( GetMinesOwned(  ) < 2 ) )
    set gCond_NeedExp2 = ( ( GetGold(  ) < 1000 ) and ( GetMinesOwned(  ) < 3 ) )
    set gCond_AttackWithAxemen = ( GetUnitCountDone( 'h01F' ) > 0 )
    set gCond_AttackWithRiflemen = ( GetUnitCountDone( 'h01Y' ) > 0 )
    set gCond_AttackWithKnights = ( GetUnitCountDone( 'n049' ) > 0 )
    set gCond_AttackWithRavensAnim = ( GetUnitCountDone( 'e005' ) > 0 )
    set gCond_AttackWithBearsAnim = ( GetUnitCountDone( 'e00A' ) > 0 )
    set gCond_AttackWithProtectors = ( GetUnitCountDone( 'h01J' ) > 0 )
    set gCond_AttackWithDragonitos = ( GetUnitCountDone( 'n04A' ) > 0 )
    set gCond_AttackWithRocTwoHeads = ( GetUnitCountDone( 'e00E' ) > 0 )
    set gCond_AttackWithCannons = ( GetUnitCountDone( 'gu01' ) > 0 )
    set gCond_AttackWithWildWorgens = ( GetUnitCountDone( 'n04C' ) > 0 )
    set gCond_AttackWithRiflemanWorgens = ( GetUnitCountDone( 'n04D' ) > 0 )
    set gCond_AttackWithKnightWorgens = ( GetUnitCountDone( 'n04E' ) > 0 )
    set gCond_AttackWithProtectorWorgens = ( GetUnitCountDone( 'n04F' ) > 0 )
    set gCond_BuildHumanBarracks = ( ( TownThreatened(  ) == false ) and ( GetUpgradeLevel( 'R034' ) == 0 ) )
    set gCond_BuildWorgenBarracks = ( ( TownThreatened(  ) == false ) and ( GetUpgradeLevel( 'R034' ) == 1 ) )
    set gCond_TrainProtectosAI = ( GetUnitCountDone( 'n04F' ) < 6 )
    set gCond_AtacarAEnemigo = ( FoodUsed(  ) > 100 )
    set gCond_Farmeo_avanzado = ( FoodUsed(  ) > 87 )
    set gCond_Farmeo_Mediano = ( FoodUsed(  ) > 57 )
    set gCond_NeedExpansionRequiere = ( ( FoodUsed(  ) > 42 ) and ( ExpansionNeeded(  ) == true ) )
    set gCond_RushCommand = ( CheckLastCommand( false ) == 1 )
    set gCond_RushForces = ( FoodUsed(  ) < 75 )
endfunction

//***************************************************************************
//*
//*  Heroes
//*
//***************************************************************************

//===========================================================================
// Stores hero ID and skills
//===========================================================================
function SetHero takes integer order, integer heroid returns nothing
    if (order == 1) then
        set hero_id = heroid
        if (heroid == 'H01Z') then
            set skills1[ 1] = 'AEfk'
            set skills1[ 2] = 'ANdr'
            set skills1[ 3] = 'AOcr'
            set skills1[ 4] = 'AEfk'
            set skills1[ 5] = 'ANdr'
            set skills1[ 6] = 'ANch'
            set skills1[ 7] = 'AOcr'
            set skills1[ 8] = 'AEfk'
            set skills1[ 9] = 'ANdr'
            set skills1[10] = 'AOcr'
            set skills1[11] = 'AEfk'
            set skills1[12] = 'ANch'
            set skills1[13] = 'ANdr'
            set skills1[14] = 'AOcr'
            set skills1[15] = 'AEfk'
            set skills1[16] = 'ANdr'
            set skills1[17] = 'AOcr'
            set skills1[18] = 'AEfk'
            set skills1[19] = 'ANdr'
            set skills1[20] = 'AOcr'
        elseif (heroid == 'U011') then
            set skills1[ 1] = 'AOhw'
            set skills1[ 2] = 'AHds'
            set skills1[ 3] = 'AEah'
            set skills1[ 4] = 'AOhw'
            set skills1[ 5] = 'AHds'
            set skills1[ 6] = 'AHre'
            set skills1[ 7] = 'AEah'
            set skills1[ 8] = 'AOhw'
            set skills1[ 9] = 'AHds'
            set skills1[10] = 'AEah'
            set skills1[11] = 'AOhw'
            set skills1[12] = 'AHre'
            set skills1[13] = 'AHds'
            set skills1[14] = 'AEah'
            set skills1[15] = 'AOhw'
            set skills1[16] = 'AHds'
            set skills1[17] = 'AEah'
            set skills1[18] = 'AOhw'
            set skills1[19] = 'AHds'
            set skills1[20] = 'AEah'
        elseif (heroid == 'O00B') then
            set skills1[ 1] = 'ANbr'
            set skills1[ 2] = 'ANht'
            set skills1[ 3] = 'A010'
            set skills1[ 4] = 'ANbr'
            set skills1[ 5] = 'ANht'
            set skills1[ 6] = 'AOre'
            set skills1[ 7] = 'A010'
            set skills1[ 8] = 'ANbr'
            set skills1[ 9] = 'ANht'
            set skills1[10] = 'A010'
            set skills1[11] = 'ANbr'
            set skills1[12] = 'AOre'
            set skills1[13] = 'ANht'
            set skills1[14] = 'A010'
            set skills1[15] = 'ANbr'
            set skills1[16] = 'ANht'
            set skills1[17] = 'A010'
            set skills1[18] = 'ANbr'
            set skills1[19] = 'ANht'
            set skills1[20] = 'A010'
        elseif (heroid == 'H020') then
            set skills1[ 1] = 'ANfb'
            set skills1[ 2] = 'AOfs'
            set skills1[ 3] = 'AOsf'
            set skills1[ 4] = 'ANfb'
            set skills1[ 5] = 'AOfs'
            set skills1[ 6] = 'A096'
            set skills1[ 7] = 'AOsf'
            set skills1[ 8] = 'ANfb'
            set skills1[ 9] = 'AOfs'
            set skills1[10] = 'AOsf'
            set skills1[11] = 'ANfb'
            set skills1[12] = 'A096'
            set skills1[13] = 'AOfs'
            set skills1[14] = 'AOsf'
            set skills1[15] = 'ANfb'
            set skills1[16] = 'AOfs'
            set skills1[17] = 'AOsf'
            set skills1[18] = 'ANfb'
            set skills1[19] = 'AOfs'
            set skills1[20] = 'AOsf'
        endif
    elseif (order == 2) then
        set hero_id2 = heroid
        if (heroid == 'H01Z') then
            set skills2[ 1] = 'AEfk'
            set skills2[ 2] = 'ANdr'
            set skills2[ 3] = 'AOcr'
            set skills2[ 4] = 'AEfk'
            set skills2[ 5] = 'ANdr'
            set skills2[ 6] = 'ANch'
            set skills2[ 7] = 'AOcr'
            set skills2[ 8] = 'AEfk'
            set skills2[ 9] = 'ANdr'
            set skills2[10] = 'AOcr'
            set skills2[11] = 'AEfk'
            set skills2[12] = 'ANch'
            set skills2[13] = 'ANdr'
            set skills2[14] = 'AOcr'
            set skills2[15] = 'AEfk'
            set skills2[16] = 'ANdr'
            set skills2[17] = 'AOcr'
            set skills2[18] = 'AEfk'
            set skills2[19] = 'ANdr'
            set skills2[20] = 'AOcr'
        elseif (heroid == 'U011') then
            set skills2[ 1] = 'AOhw'
            set skills2[ 2] = 'AHds'
            set skills2[ 3] = 'AEah'
            set skills2[ 4] = 'AOhw'
            set skills2[ 5] = 'AHds'
            set skills2[ 6] = 'AHre'
            set skills2[ 7] = 'AEah'
            set skills2[ 8] = 'AOhw'
            set skills2[ 9] = 'AHds'
            set skills2[10] = 'AEah'
            set skills2[11] = 'AOhw'
            set skills2[12] = 'AHre'
            set skills2[13] = 'AHds'
            set skills2[14] = 'AEah'
            set skills2[15] = 'AOhw'
            set skills2[16] = 'AHds'
            set skills2[17] = 'AEah'
            set skills2[18] = 'AOhw'
            set skills2[19] = 'AHds'
            set skills2[20] = 'AEah'
        elseif (heroid == 'O00B') then
            set skills2[ 1] = 'ANbr'
            set skills2[ 2] = 'ANht'
            set skills2[ 3] = 'A010'
            set skills2[ 4] = 'ANbr'
            set skills2[ 5] = 'ANht'
            set skills2[ 6] = 'AOre'
            set skills2[ 7] = 'A010'
            set skills2[ 8] = 'ANbr'
            set skills2[ 9] = 'ANht'
            set skills2[10] = 'A010'
            set skills2[11] = 'ANbr'
            set skills2[12] = 'AOre'
            set skills2[13] = 'ANht'
            set skills2[14] = 'A010'
            set skills2[15] = 'ANbr'
            set skills2[16] = 'ANht'
            set skills2[17] = 'A010'
            set skills2[18] = 'ANbr'
            set skills2[19] = 'ANht'
            set skills2[20] = 'A010'
        elseif (heroid == 'H020') then
            set skills2[ 1] = 'ANfb'
            set skills2[ 2] = 'AOfs'
            set skills2[ 3] = 'AOsf'
            set skills2[ 4] = 'ANfb'
            set skills2[ 5] = 'AOfs'
            set skills2[ 6] = 'A096'
            set skills2[ 7] = 'AOsf'
            set skills2[ 8] = 'ANfb'
            set skills2[ 9] = 'AOfs'
            set skills2[10] = 'AOsf'
            set skills2[11] = 'ANfb'
            set skills2[12] = 'A096'
            set skills2[13] = 'AOfs'
            set skills2[14] = 'AOsf'
            set skills2[15] = 'ANfb'
            set skills2[16] = 'AOfs'
            set skills2[17] = 'AOsf'
            set skills2[18] = 'ANfb'
            set skills2[19] = 'AOfs'
            set skills2[20] = 'AOsf'
        endif
    elseif (order == 3) then
        set hero_id3 = heroid
        if (heroid == 'H01Z') then
            set skills3[ 1] = 'AEfk'
            set skills3[ 2] = 'ANdr'
            set skills3[ 3] = 'AOcr'
            set skills3[ 4] = 'AEfk'
            set skills3[ 5] = 'ANdr'
            set skills3[ 6] = 'ANch'
            set skills3[ 7] = 'AOcr'
            set skills3[ 8] = 'AEfk'
            set skills3[ 9] = 'ANdr'
            set skills3[10] = 'AOcr'
            set skills3[11] = 'AEfk'
            set skills3[12] = 'ANch'
            set skills3[13] = 'ANdr'
            set skills3[14] = 'AOcr'
            set skills3[15] = 'AEfk'
            set skills3[16] = 'ANdr'
            set skills3[17] = 'AOcr'
            set skills3[18] = 'AEfk'
            set skills3[19] = 'ANdr'
            set skills3[20] = 'AOcr'
        elseif (heroid == 'U011') then
            set skills3[ 1] = 'AOhw'
            set skills3[ 2] = 'AHds'
            set skills3[ 3] = 'AEah'
            set skills3[ 4] = 'AOhw'
            set skills3[ 5] = 'AHds'
            set skills3[ 6] = 'AHre'
            set skills3[ 7] = 'AEah'
            set skills3[ 8] = 'AOhw'
            set skills3[ 9] = 'AHds'
            set skills3[10] = 'AEah'
            set skills3[11] = 'AOhw'
            set skills3[12] = 'AHre'
            set skills3[13] = 'AHds'
            set skills3[14] = 'AEah'
            set skills3[15] = 'AOhw'
            set skills3[16] = 'AHds'
            set skills3[17] = 'AEah'
            set skills3[18] = 'AOhw'
            set skills3[19] = 'AHds'
            set skills3[20] = 'AEah'
        elseif (heroid == 'O00B') then
            set skills3[ 1] = 'ANbr'
            set skills3[ 2] = 'ANht'
            set skills3[ 3] = 'A010'
            set skills3[ 4] = 'ANbr'
            set skills3[ 5] = 'ANht'
            set skills3[ 6] = 'AOre'
            set skills3[ 7] = 'A010'
            set skills3[ 8] = 'ANbr'
            set skills3[ 9] = 'ANht'
            set skills3[10] = 'A010'
            set skills3[11] = 'ANbr'
            set skills3[12] = 'AOre'
            set skills3[13] = 'ANht'
            set skills3[14] = 'A010'
            set skills3[15] = 'ANbr'
            set skills3[16] = 'ANht'
            set skills3[17] = 'A010'
            set skills3[18] = 'ANbr'
            set skills3[19] = 'ANht'
            set skills3[20] = 'A010'
        elseif (heroid == 'H020') then
            set skills3[ 1] = 'ANfb'
            set skills3[ 2] = 'AOfs'
            set skills3[ 3] = 'AOsf'
            set skills3[ 4] = 'ANfb'
            set skills3[ 5] = 'AOfs'
            set skills3[ 6] = 'A096'
            set skills3[ 7] = 'AOsf'
            set skills3[ 8] = 'ANfb'
            set skills3[ 9] = 'AOfs'
            set skills3[10] = 'AOsf'
            set skills3[11] = 'ANfb'
            set skills3[12] = 'A096'
            set skills3[13] = 'AOfs'
            set skills3[14] = 'AOsf'
            set skills3[15] = 'ANfb'
            set skills3[16] = 'AOfs'
            set skills3[17] = 'AOsf'
            set skills3[18] = 'ANfb'
            set skills3[19] = 'AOfs'
            set skills3[20] = 'AOsf'
        endif
    endif
endfunction

//===========================================================================
// Selects hero IDs for three possible heroes
//===========================================================================
function SelectHeroes takes nothing returns nothing
    local integer roll = GetRandomInt(1,100)
    //1
    if (roll <= 4) then //1
        call SetHero( 1, 'H01Z' )
        call SetHero( 2, 'U011' )
        call SetHero( 3, 'O00B' )
    //2
    elseif (roll <= 8) then
        call SetHero( 1, 'H01Z' )
        call SetHero( 2, 'U011' )
        call SetHero( 3, 'H020' )
    //3
    elseif (roll <= 12) then
        call SetHero( 1, 'H01Z' )
        call SetHero( 2, 'O00B' )
        call SetHero( 3, 'U011' )
    //4
    elseif (roll <= 16) then
        call SetHero( 1, 'H01Z' )
        call SetHero( 2, 'O00B' )
        call SetHero( 3, 'H020' )
    //5
    elseif (roll <= 20) then
        call SetHero( 1, 'H01Z' )
        call SetHero( 2, 'H020' )
        call SetHero( 3, 'U011' )
    //6
    elseif (roll <= 24) then
        call SetHero( 1, 'H01Z' )
        call SetHero( 2, 'H020' )
        call SetHero( 3, 'O00B' )
    //7
    elseif (roll <= 28) then
        call SetHero( 1, 'U011' )
        call SetHero( 2, 'H01Z' )
        call SetHero( 3, 'O00B' )
    //8
    elseif (roll <= 32) then
        call SetHero( 1, 'U011' )
        call SetHero( 2, 'H01Z' )
        call SetHero( 3, 'H020' )
    //9
    elseif (roll <= 36) then
        call SetHero( 1, 'U011' )
        call SetHero( 2, 'O00B' )
        call SetHero( 3, 'H01Z' )
    //10
    elseif (roll <= 40) then
        call SetHero( 1, 'U011' )
        call SetHero( 2, 'O00B' )
        call SetHero( 3, 'H020' )
    //11
    elseif (roll <= 44) then
        call SetHero( 1, 'U011' )
        call SetHero( 2, 'H020' )
        call SetHero( 3, 'H01Z' )
    //12
    elseif (roll <= 48) then
        call SetHero( 1, 'U011' )
        call SetHero( 2, 'H020' )
        call SetHero( 3, 'O00B' )
    //13
    elseif (roll <= 52) then
        call SetHero( 1, 'O00B' )
        call SetHero( 2, 'H01Z' )
        call SetHero( 3, 'U011' )
    //14
    elseif (roll <= 56) then
        call SetHero( 1, 'O00B' )
        call SetHero( 2, 'H01Z' )
        call SetHero( 3, 'H020' )
    //15
    elseif (roll <= 60) then
        call SetHero( 1, 'O00B' )
        call SetHero( 2, 'U011' )
        call SetHero( 3, 'H01Z' )
    //16
    elseif (roll <= 64) then
        call SetHero( 1, 'O00B' )
        call SetHero( 2, 'U011' )
        call SetHero( 3, 'H020' )
    //17
    elseif (roll <= 68) then
        call SetHero( 1, 'O00B' )
        call SetHero( 2, 'H020' )
        call SetHero( 3, 'H01Z' )
    //18
    elseif (roll <= 72) then
        call SetHero( 1, 'O00B' )
        call SetHero( 2, 'H020' )
        call SetHero( 3, 'U011' )
    //19
    elseif (roll <= 76) then
        call SetHero( 1, 'H020' )
        call SetHero( 2, 'H01Z' )
        call SetHero( 3, 'U011' )
    //20
    elseif (roll <= 80) then
        call SetHero( 1, 'H020' )
        call SetHero( 2, 'H01Z' )
        call SetHero( 3, 'O00B' )
    //21
    elseif (roll <= 84) then
        call SetHero( 1, 'H020' )
        call SetHero( 2, 'U011' )
        call SetHero( 3, 'H01Z' )
    //22
    elseif (roll <= 88) then
        call SetHero( 1, 'H020' )
        call SetHero( 2, 'U011' )
        call SetHero( 3, 'O00B' )
    //23
    elseif (roll <= 92) then
        call SetHero( 1, 'H020' )
        call SetHero( 2, 'O00B' )
        call SetHero( 3, 'H01Z' )
    //24
    else
        call SetHero( 1, 'H020' )
        call SetHero( 2, 'O00B' )
        call SetHero( 3, 'U011' )
    endif
endfunction

//===========================================================================
// Returns the hero skill for the given hero and level
//===========================================================================
function ChooseHeroSkill takes nothing returns integer
    local integer curHero = GetHeroId()
    local integer level = GetHeroLevelAI()

    if (level > max_hero_level) then
        set max_hero_level = level
    endif

    if (curHero == hero_id) then
        return skills1[level]
    elseif (curHero == hero_id2) then
        return skills2[level]
    elseif (curHero == hero_id3) then
        return skills3[level]
    endif
    return 0
endfunction

//***************************************************************************
//*
//*  Building and Harvesting
//*
//***************************************************************************

//===========================================================================
// Specifies building priorities for workers
//===========================================================================
function BuildPriorities takes nothing returns nothing
    local integer mine = TownWithMine()
    if (gCond_BuildTownHall) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01K', -1 )
    endif
    if (gCond_HeroFirst) then
        call SetBuildAll( BUILD_UNIT, 1, hero_id, -1 )
    endif
    if (gCond_HeroSecond) then
        call SetBuildAll( BUILD_UNIT, 1, hero_id2, -1 )
    endif
    if (gCond_HeroThird) then
        call SetBuildAll( BUILD_UNIT, 1, hero_id3, -1 )
    endif
    call SetBuildAll( BUILD_UNIT, 1, 'h01H', -1 )
    if (gCond_Workers1) then
        call SetBuildAll( BUILD_UNIT, 2, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 3, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 4, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 5, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 6, 'h01H', -1 )
    endif
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01N', -1 )
    endif
    if (gCond_Workers1) then
        call SetBuildAll( BUILD_UNIT, 7, 'h01H', -1 )
    endif
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01O', -1 )
    endif
    if (gCond_Workers1) then
        call SetBuildAll( BUILD_UNIT, 8, 'h01H', -1 )
    endif
    if (gCond_BuildHumanBarracks) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01G', -1 )
    endif
    if (gCond_Workers1) then
        call SetBuildAll( BUILD_UNIT, 9, 'h01H', -1 )
    endif
    if (gCond_BuildWorgenBarracks) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01P', -1 )
    endif
    if (gCond_Workers1) then
        call SetBuildAll( BUILD_UNIT, 10, 'h01H', -1 )
    endif
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01X', -1 )
    endif
    if (gCond_TrainAxemen) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01F', -1 )
    endif
    if (gCond_TrainWildWorges) then
        call SetBuildAll( BUILD_UNIT, 1, 'n04C', -1 )
    endif
    if (gCond_TrainAxemen) then
        call SetBuildAll( BUILD_UNIT, 2, 'h01F', -1 )
    endif
    if (gCond_TrainWildWorges) then
        call SetBuildAll( BUILD_UNIT, 2, 'n04C', -1 )
    endif
    if (gCond_TrainAxemen) then
        call SetBuildAll( BUILD_UNIT, 3, 'h01F', -1 )
    endif
    if (gCond_TrainWildWorges) then
        call SetBuildAll( BUILD_UNIT, 3, 'n04C', -1 )
    endif
    if (gCond_TrainAxemen) then
        call SetBuildAll( BUILD_UNIT, 4, 'h01F', -1 )
    endif
    if (gCond_TrainWildWorges) then
        call SetBuildAll( BUILD_UNIT, 4, 'n04C', -1 )
    endif
    if (gCond_TrainAxemen) then
        call SetBuildAll( BUILD_UNIT, 5, 'h01F', -1 )
    endif
    if (gCond_TrainWildWorges) then
        call SetBuildAll( BUILD_UNIT, 5, 'n04C', -1 )
    endif
    call SetBuildAll( BUILD_UPGRADE, 1, 'Rhde', -1 )
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 2, 'h01N', -1 )
    endif
    if (gCond_Workers1) then
        call SetBuildAll( BUILD_UNIT, 11, 'h01H', -1 )
    endif
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01Q', -1 )
    endif
    if (gCond_Workers1) then
        call SetBuildAll( BUILD_UNIT, 12, 'h01H', -1 )
    endif
    if (gCond_BuildHumanBarracks) then
        call SetBuildAll( BUILD_UNIT, 2, 'h01G', -1 )
    endif
    if (gCond_BuildWorgenBarracks) then
        call SetBuildAll( BUILD_UNIT, 3, 'h01P', -1 )
    endif
    if (gCond_Workers1) then
        call SetBuildAll( BUILD_UNIT, 13, 'h01H', -1 )
    endif
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01R', -1 )
    endif
    if (gCond_Workers1) then
        call SetBuildAll( BUILD_UNIT, 14, 'h01H', -1 )
    endif
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 2, 'h01R', -1 )
    endif
    if (gCond_Workers1) then
        call SetBuildAll( BUILD_UNIT, 15, 'h01H', -1 )
    endif
    if (gCond_TrainRiflemen) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01Y', -1 )
    endif
    if (gCond_TrainRiflemanWorges) then
        call SetBuildAll( BUILD_UNIT, 1, 'n04D', -1 )
    endif
    if (gCond_TrainRiflemen) then
        call SetBuildAll( BUILD_UNIT, 2, 'h01Y', -1 )
    endif
    if (gCond_TrainRiflemanWorges) then
        call SetBuildAll( BUILD_UNIT, 2, 'n04D', -1 )
    endif
    if (gCond_TrainRiflemen) then
        call SetBuildAll( BUILD_UNIT, 3, 'h01Y', -1 )
    endif
    if (gCond_TrainRiflemanWorges) then
        call SetBuildAll( BUILD_UNIT, 3, 'n04D', -1 )
    endif
    if (gCond_TrainRiflemen) then
        call SetBuildAll( BUILD_UNIT, 4, 'h01Y', -1 )
    endif
    if (gCond_TrainRiflemanWorges) then
        call SetBuildAll( BUILD_UNIT, 4, 'n04D', -1 )
    endif
    if (gCond_TrainRiflemen) then
        call SetBuildAll( BUILD_UNIT, 5, 'h01Y', -1 )
    endif
    if (gCond_TrainRiflemanWorges) then
        call SetBuildAll( BUILD_UNIT, 5, 'n04D', -1 )
    endif
    if (gCond_TrainRiflemen) then
        call SetBuildAll( BUILD_UNIT, 6, 'h01Y', -1 )
    endif
    if (gCond_TrainRiflemanWorges) then
        call SetBuildAll( BUILD_UNIT, 6, 'n04D', -1 )
    endif
    call SetBuildAll( BUILD_UPGRADE, 1, 'Rhlh', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'Rhac', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'Rhme', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'Rhra', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'Rhar', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'Rhla', -1 )
    if (gCond_BuildTowers) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01U', -1 )
    endif
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01V', -1 )
        call SetBuildAll( BUILD_UNIT, 3, 'h01N', -1 )
    endif
    if (gCond_NeedExp) then
        call BuildExpansion( 'h01K', 'h01K' )
    endif
    if (gCond_Workers2) then
        call SetBuildAll( BUILD_UNIT, 16, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 17, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 18, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 19, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 20, 'h01H', -1 )
    endif
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 2, 'h01V', -1 )
    endif
    if (gCond_Workers2) then
        call SetBuildAll( BUILD_UNIT, 21, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 22, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 23, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 24, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 25, 'h01H', -1 )
    endif
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 3, 'h01V', -1 )
    endif
    if (gCond_Workers2) then
        call SetBuildAll( BUILD_UNIT, 26, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 27, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 28, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 29, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 30, 'h01H', -1 )
    endif
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 4, 'h01N', -1 )
    endif
    if (gCond_TrainAxemen) then
        call SetBuildAll( BUILD_UNIT, 6, 'h01F', -1 )
    endif
    if (gCond_TrainWildWorges) then
        call SetBuildAll( BUILD_UNIT, 6, 'n04C', -1 )
    endif
    if (gCond_TrainAxemen) then
        call SetBuildAll( BUILD_UNIT, 7, 'h01F', -1 )
    endif
    if (gCond_TrainWildWorges) then
        call SetBuildAll( BUILD_UNIT, 7, 'n04C', -1 )
    endif
    if (gCond_TrainAxemen) then
        call SetBuildAll( BUILD_UNIT, 8, 'h01F', -1 )
    endif
    if (gCond_TrainWildWorges) then
        call SetBuildAll( BUILD_UNIT, 8, 'n04C', -1 )
    endif
    if (gCond_TrainAxemen) then
        call SetBuildAll( BUILD_UNIT, 9, 'h01F', -1 )
    endif
    if (gCond_TrainWildWorges) then
        call SetBuildAll( BUILD_UNIT, 9, 'n04C', -1 )
    endif
    if (gCond_TrainAxemen) then
        call SetBuildAll( BUILD_UNIT, 10, 'h01F', -1 )
    endif
    if (gCond_TrainWildWorges) then
        call SetBuildAll( BUILD_UNIT, 10, 'n04C', -1 )
    endif
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 5, 'h01N', -1 )
    endif
    if (gCond_TrainRiflemen) then
        call SetBuildAll( BUILD_UNIT, 7, 'h01Y', -1 )
    endif
    if (gCond_TrainRiflemanWorges) then
        call SetBuildAll( BUILD_UNIT, 7, 'n04D', -1 )
    endif
    if (gCond_TrainRiflemen) then
        call SetBuildAll( BUILD_UNIT, 8, 'h01Y', -1 )
    endif
    if (gCond_TrainRiflemanWorges) then
        call SetBuildAll( BUILD_UNIT, 8, 'n04D', -1 )
    endif
    if (gCond_TrainRiflemen) then
        call SetBuildAll( BUILD_UNIT, 9, 'h01Y', -1 )
    endif
    if (gCond_TrainRiflemanWorges) then
        call SetBuildAll( BUILD_UNIT, 9, 'n04D', -1 )
    endif
    if (gCond_TrainRiflemen) then
        call SetBuildAll( BUILD_UNIT, 10, 'h01Y', -1 )
    endif
    if (gCond_TrainRiflemanWorges) then
        call SetBuildAll( BUILD_UNIT, 10, 'n04D', -1 )
    endif
    call SetBuildAll( BUILD_UPGRADE, 2, 'Rhac', -1 )
    call SetBuildAll( BUILD_UPGRADE, 2, 'Rhme', -1 )
    call SetBuildAll( BUILD_UPGRADE, 2, 'Rhra', -1 )
    call SetBuildAll( BUILD_UPGRADE, 2, 'Rhar', -1 )
    call SetBuildAll( BUILD_UPGRADE, 2, 'Rhla', -1 )
    if (gCond_UpgradeToKeep) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01L', -1 )
    endif
    call SetBuildAll( BUILD_UPGRADE, 1, 'R02X', -1 )
    call SetBuildAll( BUILD_UPGRADE, 2, 'Rhlh', -1 )
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 6, 'h01N', -1 )
    endif
    if (gCond_TrainKnights) then
        call SetBuildAll( BUILD_UNIT, 1, 'n049', -1 )
    endif
    if (gCond_TrainKnightWorges) then
        call SetBuildAll( BUILD_UNIT, 1, 'n04E', -1 )
    endif
    if (gCond_TrainKnights) then
        call SetBuildAll( BUILD_UNIT, 2, 'n049', -1 )
    endif
    if (gCond_TrainKnightWorges) then
        call SetBuildAll( BUILD_UNIT, 2, 'n04E', -1 )
    endif
    if (gCond_TrainKnights) then
        call SetBuildAll( BUILD_UNIT, 3, 'n049', -1 )
    endif
    if (gCond_TrainKnightWorges) then
        call SetBuildAll( BUILD_UNIT, 3, 'n04E', -1 )
    endif
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01S', -1 )
        call SetBuildAll( BUILD_UNIT, 2, 'h01S', -1 )
    endif
    call SetBuildAll( BUILD_UNIT, 1, 'e005', -1 )
    call SetBuildAll( BUILD_UNIT, 2, 'e005', -1 )
    call SetBuildAll( BUILD_UNIT, 3, 'e005', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'R02Y', -1 )
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 7, 'h01N', -1 )
    endif
    call SetBuildAll( BUILD_UNIT, 1, 'e00A', -1 )
    call SetBuildAll( BUILD_UNIT, 2, 'e00A', -1 )
    call SetBuildAll( BUILD_UNIT, 3, 'e00A', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'R030', -1 )
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 8, 'h01N', -1 )
    endif
    if (gCond_TrainProtectosAI) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01J', -1 )
    endif
    if (gCond_TrainProtectorWorges) then
        call SetBuildAll( BUILD_UNIT, 1, 'n04F', -1 )
    endif
    if (gCond_TrainProtectosAI) then
        call SetBuildAll( BUILD_UNIT, 2, 'h01J', -1 )
    endif
    if (gCond_TrainProtectorWorges) then
        call SetBuildAll( BUILD_UNIT, 2, 'n04F', -1 )
    endif
    if (gCond_TrainProtectosAI) then
        call SetBuildAll( BUILD_UNIT, 3, 'h01J', -1 )
    endif
    if (gCond_TrainProtectorWorges) then
        call SetBuildAll( BUILD_UNIT, 3, 'n04F', -1 )
    endif
    if (gCond_TrainProtectosAI) then
        call SetBuildAll( BUILD_UNIT, 4, 'h01J', -1 )
    endif
    if (gCond_TrainProtectorWorges) then
        call SetBuildAll( BUILD_UNIT, 4, 'n04F', -1 )
    endif
    call SetBuildAll( BUILD_UPGRADE, 1, 'R032', -1 )
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01T', -1 )
        call SetBuildAll( BUILD_UNIT, 2, 'h01T', -1 )
        call SetBuildAll( BUILD_UNIT, 9, 'h01N', -1 )
    endif
    call SetBuildAll( BUILD_UNIT, 1, 'n04A', -1 )
    call SetBuildAll( BUILD_UNIT, 2, 'n04A', -1 )
    call SetBuildAll( BUILD_UNIT, 3, 'n04A', -1 )
    call SetBuildAll( BUILD_UPGRADE, 3, 'Rhac', -1 )
    call SetBuildAll( BUILD_UPGRADE, 3, 'Rhme', -1 )
    call SetBuildAll( BUILD_UPGRADE, 3, 'Rhra', -1 )
    call SetBuildAll( BUILD_UPGRADE, 3, 'Rhar', -1 )
    call SetBuildAll( BUILD_UPGRADE, 3, 'Rhla', -1 )
    call SetBuildAll( BUILD_UNIT, 1, 'h01W', -1 )
    if (gCond_NeedExp2) then
        call BuildExpansion( 'h01K', 'h01K' )
    endif
    call SetBuildAll( BUILD_UNIT, 2, 'h01W', -1 )
    if (gCond_Workers3) then
        call SetBuildAll( BUILD_UNIT, 31, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 32, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 33, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 34, 'h01H', -1 )
        call SetBuildAll( BUILD_UNIT, 35, 'h01H', -1 )
    endif
    call SetBuildAll( BUILD_UNIT, 3, 'h01W', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'Rhse', -1 )
    call SetBuildAll( BUILD_UPGRADE, 4, 'Rhac', -1 )
    call SetBuildAll( BUILD_UPGRADE, 4, 'Rhme', -1 )
    call SetBuildAll( BUILD_UPGRADE, 4, 'Rhra', -1 )
    call SetBuildAll( BUILD_UPGRADE, 4, 'Rhar', -1 )
    call SetBuildAll( BUILD_UPGRADE, 4, 'Rhla', -1 )
    if (gCond_UpgradeToCastle) then
        call SetBuildAll( BUILD_UNIT, 1, 'h01M', -1 )
    endif
    call SetBuildAll( BUILD_UPGRADE, 1, 'Rehs', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'Rers', -1 )
    call SetBuildAll( BUILD_UPGRADE, 2, 'R02Y', -1 )
    call SetBuildAll( BUILD_UPGRADE, 2, 'R030', -1 )
    call SetBuildAll( BUILD_UPGRADE, 2, 'R032', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'R033', -1 )
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 10, 'h01N', -1 )
    endif
    call SetBuildAll( BUILD_UNIT, 1, 'e00E', -1 )
    call SetBuildAll( BUILD_UNIT, 2, 'e00E', -1 )
    call SetBuildAll( BUILD_UNIT, 3, 'e00E', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'R03X', -1 )
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 11, 'h01N', -1 )
        call SetBuildAll( BUILD_UNIT, 1, 'h02A', -1 )
        call SetBuildAll( BUILD_UNIT, 2, 'h02A', -1 )
    endif
    call SetBuildAll( BUILD_UNIT, 1, 'gu01', -1 )
    call SetBuildAll( BUILD_UNIT, 2, 'gu01', -1 )
    call SetBuildAll( BUILD_UNIT, 3, 'gu01', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'R03W', -1 )
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 12, 'h01N', -1 )
    endif
    if (gCond_TrainAxemen) then
        call SetBuildAll( BUILD_UNIT, 11, 'h01F', -1 )
    endif
    if (gCond_TrainWildWorges) then
        call SetBuildAll( BUILD_UNIT, 11, 'n04C', -1 )
    endif
    if (gCond_TrainAxemen) then
        call SetBuildAll( BUILD_UNIT, 12, 'h01F', -1 )
    endif
    if (gCond_TrainWildWorges) then
        call SetBuildAll( BUILD_UNIT, 12, 'n04C', -1 )
    endif
    if (gCond_TrainAxemen) then
        call SetBuildAll( BUILD_UNIT, 13, 'h01F', -1 )
    endif
    if (gCond_TrainWildWorges) then
        call SetBuildAll( BUILD_UNIT, 13, 'n04C', -1 )
    endif
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 13, 'h01N', -1 )
    endif
    if (gCond_TrainRiflemen) then
        call SetBuildAll( BUILD_UNIT, 11, 'h01Y', -1 )
    endif
    if (gCond_TrainRiflemanWorges) then
        call SetBuildAll( BUILD_UNIT, 11, 'n04D', -1 )
    endif
    if (gCond_TrainRiflemen) then
        call SetBuildAll( BUILD_UNIT, 12, 'h01Y', -1 )
    endif
    if (gCond_TrainRiflemanWorges) then
        call SetBuildAll( BUILD_UNIT, 12, 'n04D', -1 )
    endif
    if (gCond_TrainKnights) then
        call SetBuildAll( BUILD_UNIT, 4, 'n049', -1 )
    endif
    if (gCond_TrainKnightWorges) then
        call SetBuildAll( BUILD_UNIT, 4, 'n04E', -1 )
    endif
    if (gCond_TrainProtectosAI) then
        call SetBuildAll( BUILD_UNIT, 5, 'h01J', -1 )
    endif
    if (gCond_TrainProtectorWorges) then
        call SetBuildAll( BUILD_UNIT, 5, 'n04F', -1 )
    endif
    if (gCond_TrainProtectosAI) then
        call SetBuildAll( BUILD_UNIT, 6, 'h01J', -1 )
    endif
    if (gCond_TrainProtectorWorges) then
        call SetBuildAll( BUILD_UNIT, 6, 'n04F', -1 )
    endif
    if (gCond_BuildGeneral) then
        call SetBuildAll( BUILD_UNIT, 1, 'h02B', -1 )
        call SetBuildAll( BUILD_UNIT, 2, 'h02B', -1 )
        call SetBuildAll( BUILD_UNIT, 3, 'h02B', -1 )
    endif
    call SetBuildAll( BUILD_UPGRADE, 1, 'R034', -1 )
    call SetBuildAll( BUILD_UPGRADE, 3, 'Rhlh', -1 )
    call SetBuildAll( BUILD_UPGRADE, 3, 'R02Y', -1 )
    call SetBuildAll( BUILD_UPGRADE, 3, 'R030', -1 )
    call SetBuildAll( BUILD_UPGRADE, 2, 'R033', -1 )
    call SetBuildAll( BUILD_UPGRADE, 5, 'Rhac', -1 )
    call SetBuildAll( BUILD_UPGRADE, 5, 'Rhme', -1 )
    call SetBuildAll( BUILD_UPGRADE, 5, 'Rhra', -1 )
    call SetBuildAll( BUILD_UPGRADE, 5, 'Rhar', -1 )
    call SetBuildAll( BUILD_UPGRADE, 5, 'Rhla', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'R035', -1 )
    call SetBuildAll( BUILD_UPGRADE, 4, 'Rhlh', -1 )
    call SetBuildAll( BUILD_UPGRADE, 4, 'R02Y', -1 )
    call SetBuildAll( BUILD_UPGRADE, 4, 'R030', -1 )
    call SetBuildAll( BUILD_UPGRADE, 6, 'Rhac', -1 )
    call SetBuildAll( BUILD_UPGRADE, 6, 'Rhme', -1 )
    call SetBuildAll( BUILD_UPGRADE, 6, 'Rhra', -1 )
    call SetBuildAll( BUILD_UPGRADE, 6, 'Rhar', -1 )
    call SetBuildAll( BUILD_UPGRADE, 6, 'Rhla', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'R02Z', -1 )
    call SetBuildAll( BUILD_UPGRADE, 2, 'R02Z', -1 )
    call SetBuildAll( BUILD_UPGRADE, 3, 'R02Z', -1 )
    call SetBuildAll( BUILD_UPGRADE, 1, 'R031', -1 )
    call SetBuildAll( BUILD_UPGRADE, 2, 'R031', -1 )
    call SetBuildAll( BUILD_UPGRADE, 3, 'R031', -1 )
endfunction

//===========================================================================
// Specifies harvesting priorities for workers
//===========================================================================
function HarvestPriorities takes nothing returns nothing
    local integer mine = TownWithMine()
    local integer allGold = GetUnitCountDone('h01H')
    local integer allWood = GetUnitCountDone('h01H')
    local integer numWorkers
    set numWorkers = 5
    call HarvestGold( mine + 0, numWorkers )
    set numWorkers = 5
    call HarvestGold( mine + 1, numWorkers )
    set numWorkers = 5
    call HarvestGold( mine + 2, numWorkers )
    set numWorkers = 35
    call HarvestWood( mine, numWorkers )
endfunction

//===========================================================================
// Determines all building and harvesting assignments for workers
//===========================================================================
function WorkerAssignment takes nothing returns nothing
    loop
        call UpdateConditions(  )

        // Harvesting
        call ClearHarvestAI(  )
        call HarvestPriorities(  )

        // Building
        call InitBuildArray(  )
        call BuildPriorities(  )

        call Sleep( 2 )
    endloop
endfunction

//***************************************************************************
//*
//*  Attacking
//*
//***************************************************************************

//===========================================================================
// Returns true if the minimum forces for an attack exist
//===========================================================================
function HaveMinimumAttackers takes nothing returns boolean
    local integer count

    // Check for attack wave limit
    if (attackWave > 5) then
        return false
    endif

    // Attack Group: Minimun
    if (gCond_TrainAxemen) then
        set count = GetUnitCountDone( 'h01F' )
        if (count < 5) then
            return false
        endif
    endif
    if (gCond_TrainWildWorges) then
        set count = GetUnitCountDone( 'n04C' )
        if (count < 5) then
            return false
        endif
    endif
    return true
endfunction

//===========================================================================
// Assigns units to attack based on the given attack group
//===========================================================================
function PrepareAttackGroup takes integer groupID returns nothing
    local integer all

    // Attack Group #1: All Units
    if (groupID == 1) then
        set all = GetUnitCountDone( hero_id )
        call AddAttackUnit( all, all, hero_id )
        set all = GetUnitCountDone( hero_id2 )
        call AddAttackUnit( all, all, hero_id2 )
        set all = GetUnitCountDone( hero_id3 )
        call AddAttackUnit( all, all, hero_id3 )
        if (gCond_AttackWithAxemen) then
            set all = GetUnitCountDone( 'h01F' )
            call AddAttackUnit( all, all, 'h01F' )
        endif
        if (gCond_AttackWithWildWorgens) then
            set all = GetUnitCountDone( 'n04C' )
            call AddAttackUnit( all, all, 'n04C' )
        endif
        if (gCond_AttackWithRiflemen) then
            set all = GetUnitCountDone( 'h01Y' )
            call AddAttackUnit( all, all, 'h01Y' )
        endif
        if (gCond_AttackWithRiflemanWorgens) then
            set all = GetUnitCountDone( 'n04D' )
            call AddAttackUnit( all, all, 'n04D' )
        endif
        if (gCond_AttackWithKnights) then
            set all = GetUnitCountDone( 'n049' )
            call AddAttackUnit( all, all, 'n049' )
        endif
        if (gCond_AttackWithKnightWorgens) then
            set all = GetUnitCountDone( 'n04E' )
            call AddAttackUnit( all, all, 'n04E' )
        endif
        if (gCond_AttackWithRavensAnim) then
            set all = GetUnitCountDone( 'e005' )
            call AddAttackUnit( all, all, 'e005' )
        endif
        if (gCond_AttackWithBearsAnim) then
            set all = GetUnitCountDone( 'e00A' )
            call AddAttackUnit( all, all, 'e00A' )
        endif
        if (gCond_AttackWithProtectors) then
            set all = GetUnitCountDone( 'h01J' )
            call AddAttackUnit( all, all, 'h01J' )
        endif
        if (gCond_AttackWithProtectorWorgens) then
            set all = GetUnitCountDone( 'n04F' )
            call AddAttackUnit( all, all, 'n04F' )
        endif
        if (gCond_AttackWithDragonitos) then
            set all = GetUnitCountDone( 'n04A' )
            call AddAttackUnit( all, all, 'n04A' )
        endif
        if (gCond_AttackWithRocTwoHeads) then
            set all = GetUnitCountDone( 'e00E' )
            call AddAttackUnit( all, all, 'e00E' )
        endif
        if (gCond_AttackWithCannons) then
            set all = GetUnitCountDone( 'gu01' )
            call AddAttackUnit( all, all, 'gu01' )
        endif

        // Attack Group #2: Minimun
    elseif (groupID == 2) then
        set all = GetUnitCountDone( hero_id )
        call AddAttackUnit( all, all, hero_id )
        if (gCond_TrainAxemen) then
            set all = GetUnitCountDone( 'h01F' )
            call AddAttackUnit( all, -1,  'h01F' )
        endif
        if (gCond_TrainWildWorges) then
            set all = GetUnitCountDone( 'n04C' )
            call AddAttackUnit( all, -1,  'n04C' )
        endif

    endif
endfunction

//===========================================================================
// Prepares an attack group based on the current attack wave
//===========================================================================
function PrepareForces takes nothing returns nothing
    if (attackWave == 1) then
        call PrepareAttackGroup( 1 )
    elseif (attackWave == 2) then
        call PrepareAttackGroup( 1 )
    elseif (attackWave == 3) then
        call PrepareAttackGroup( 1 )
    elseif (attackWave == 4) then
        call PrepareAttackGroup( 1 )
    elseif (attackWave == 5) then
        call PrepareAttackGroup( 1 )
    endif
endfunction

//===========================================================================
// Sleep delays for each attack wave
//===========================================================================
function AttackWaveDelay takes integer inWave returns nothing
    if (inWave < nextDelay) then
        return
    endif

    set nextDelay = inWave + 1
endfunction

//===========================================================================
// Advances attack wave counter
//===========================================================================
function AttackWaveUpdate takes nothing returns nothing
    call AttackWaveDelay( attackWave )
    set attackWave = attackWave + 1
    if (attackWave > 5) then
        set attackWave = 1
        set nextDelay = attackWave + 1
    endif
endfunction

//===========================================================================
// Basic attack functionality
//===========================================================================
function AttackTarget takes unit target, boolean addAlliance returns nothing
    if (target == null) then
        return
    endif
    if (addAlliance) then
        call SetAllianceTarget( target )
    endif
    call FormGroup( 3, true )
    call AttackMoveKillA( target )
    if (not addAlliance) then
        call SetAllianceTarget( null )
    endif
endfunction

//===========================================================================
// Initiates an attack based on target priorities
//===========================================================================
function LaunchAttack takes nothing returns nothing
    local unit target = null
    local boolean setAlly = true

    // Don't launch any attack while town is threatened
    if (TownThreatened()) then
        call Sleep( 2 )
        return
    endif

    //STANDARD AND DEFENDER
    //----------------------------------------------------------------------------------------------------
    /*
    if (Comport6 <= 50) then
        //Target Priority #1
        // if (RushCom2 <= 50) then
        //     if (gCond_RushForces) then
        //         if (target == null) then
        //             set target = GetMegaTarget()
        //         endif
        //     endif
        // endif

        // Target Priority #2
        if (gCond_NeedExpansionRequiere) then
            if (target == null) then
                set target = GetExpansionFoe()
                if (target != null) then
                    set take_exp = false
                endif
            endif
        endif

        // Target Priority #3
        if (gCond_AtacarAEnemigo) then
            if (target == null) then
                set target = GetAllianceTarget()
                if (target != null) then
                    set setAlly = false
                endif
            endif
        

            // Target Priority #4
            if (target == null) then
                set target = GetMegaTarget()
            endif

        
            // Target Priority #5
            if (target == null) then
                set target = GetEnemyExpansion()
                if (target == null) then
                    call StartGetEnemyBase(  )
                    loop
                        exitwhen (not WaitGetEnemyBase())
                        call SuicideSleep( 1 )
                    endloop
                    set target = GetEnemyBase()
                endif
            endif

            // Target Priority #6
            if (target == null) then
                set target = GetEnemyExpansion()
            endif
        endif

        // Target Priority #7
        if (gCond_Farmeo_avanzado) then
            if (target == null) then
                set target = GetCreepCamp( 21, 100, true )
            endif
        endif

        // Target Priority #8
        if (gCond_Farmeo_Mediano) then
            if (target == null) then
                set target = GetCreepCamp( 11, 20, true )
            endif
        endif

        // Target Priority #9
        if (target == null) then
            set target = GetCreepCamp( 0, 10, false )
        endif
        //RUSH
        //----------------------------------------------------------------------------------------------------
    else   
    */    
    // Target Priority #1
    if (gCond_NeedExpansionRequiere) then
        if (target == null) then
            set target = GetExpansionFoe()
            if (target != null) then
                set take_exp = false
            endif
        endif
    endif
    
    //Target Priority #2
    if (target == null) then
        set target = GetAllianceTarget()
        if (target != null) then
            set setAlly = false
        endif
    endif

    if (target == null) then
        set target = GetMegaTarget()
    endif

    if (target == null) then
        set target = GetEnemyExpansion()
        if (target == null) then
            call StartGetEnemyBase(  )
            loop
                exitwhen (not WaitGetEnemyBase())
                call SuicideSleep( 1 )
            endloop
            set target = GetEnemyBase()
        endif
    endif

    if (target == null) then
        set target = GetEnemyExpansion()
    endif

    // Target Priority #3
    if (gCond_AtacarAEnemigo) then
        if (target == null) then
            set target = GetAllianceTarget()
            if (target != null) then
                set setAlly = false
            endif
        endif
    

        // Target Priority #4
        if (target == null) then
            set target = GetMegaTarget()
        endif

    
        // Target Priority #5
        if (target == null) then
            set target = GetEnemyExpansion()
            if (target == null) then
                call StartGetEnemyBase(  )
                loop
                    exitwhen (not WaitGetEnemyBase())
                    call SuicideSleep( 1 )
                endloop
                set target = GetEnemyBase()
            endif
        endif

        // Target Priority #6
        if (target == null) then
            set target = GetEnemyExpansion()
        endif
    endif

    // Target Priority #7
    if (gCond_Farmeo_avanzado) then
        if (target == null) then
            set target = GetCreepCamp( 21, 100, true )
        endif
    endif

    // Target Priority #8
    if (gCond_Farmeo_Mediano) then
        if (target == null) then
            set target = GetCreepCamp( 11, 20, true )
        endif
    endif

    // Target Priority #9
    // if (target == null) then
    //     set target = GetCreepCamp( 0, 10, false )
    // endif
        
    //endif
    // Attack the target and increment attack wave
    if (target != null) then
        call AttackTarget( target, setAlly )
        call AttackWaveUpdate(  )
    else
        // If no target was found, sleep a bit before trying again
        call Sleep( 0.1 )
    endif
endfunction

//===========================================================================
// Determines all attacking assignments
//===========================================================================
function AttackAssignment takes nothing returns nothing
    call StaggerSleep( 0, 2 )
    if (attackWave == 1) then
        call AttackWaveDelay( 0 )
    endif
    loop
        loop
            call UpdateConditions(  )
            exitwhen (HaveMinimumAttackers() and not CaptainRetreating())
            call Sleep( 2 )
        endloop
        call RemoveInjuries(  )
        call ResetAttackUnits(  )
        call PrepareForces(  )
        call LaunchAttack(  )
    endloop
endfunction

//***************************************************************************
//*
//*  Main Entry Point
//*
//***************************************************************************

//===========================================================================
function main takes nothing returns nothing
    call InitAI(  )
    call SetPlayerName( ai_player, "Kingdom of Gilneas" )
    call InitOptions(  )
    call SelectHeroes(  )
    call CreateCaptains(  )
    call SetHeroLevels( function ChooseHeroSkill )

    call Sleep( 0.1 )
    call StartThread( function WorkerAssignment )
    call StartThread( function AttackAssignment )
    call PlayGame(  )
endfunction

